# 📊 구글 시트 자동 연동 설정 가이드

체험단 지원자 데이터를 구글 시트로 자동 연동하는 설정 방법입니다.

## 🚀 1단계: Google Cloud Console 설정

### 1.1 Google Cloud 프로젝트 생성
1. [Google Cloud Console](https://console.cloud.google.com/) 접속
2. 새 프로젝트 생성 또는 기존 프로젝트 선택
3. 프로젝트 이름: `BUTFIT-체험단-관리` (원하는 이름)

### 1.2 Google Sheets API 활성화
1. 왼쪽 메뉴 → **API 및 서비스** → **라이브러리**
2. `Google Sheets API` 검색 후 선택
3. **사용** 버튼 클릭
4. `Google Drive API`도 동일하게 활성화

### 1.3 서비스 계정 생성
1. 왼쪽 메뉴 → **API 및 서비스** → **사용자 인증 정보**
2. **사용자 인증 정보 만들기** → **서비스 계정**
3. 서비스 계정 정보 입력:
   - **이름**: `butfit-sheets-service`
   - **설명**: `체험단 구글시트 연동용`
4. **만들고 계속하기** 클릭
5. 역할 추가:
   - **기본** → **편집자** 선택
6. **완료** 클릭

### 1.4 서비스 계정 키 다운로드
1. 생성된 서비스 계정 클릭
2. **키** 탭 이동
3. **키 추가** → **새 키 만들기**
4. **JSON** 선택 후 **만들기**
5. 다운로드된 JSON 파일을 프로젝트 폴더에 `google_credentials.json`으로 저장

## 📋 2단계: 구글 시트 생성 및 권한 설정

### 2.1 새 구글 시트 생성
1. [Google Sheets](https://sheets.google.com) 접속
2. 새 스프레드시트 생성
3. 제목을 `BUTFIT 체험단 지원자 관리`로 변경

### 2.2 서비스 계정에 편집 권한 부여
1. 구글 시트에서 **공유** 버튼 클릭
2. 서비스 계정 이메일 주소 입력 (JSON 파일의 `client_email` 값)
3. 권한을 **편집자**로 설정
4. **보내기** 클릭

> ⚠️ **중요**: 서비스 계정 이메일은 JSON 파일에서 확인할 수 있습니다.
> 예: `butfit-sheets-service@your-project-id.iam.gserviceaccount.com`

## 🔧 3단계: 프로젝트 설정

### 3.1 인증 파일 배치
```bash
# 프로젝트 루트 디렉토리에 파일 위치 확인
solvers/
├── simple_server.py
├── google_credentials.json  ← 여기에 배치
└── ...
```

### 3.2 서버 재시작
```bash
# 기존 서버 종료
lsof -ti:8000 | xargs kill -9

# 새로운 서버 시작
source venv/bin/activate && python3 simple_server.py
```

## 🎯 4단계: 동작 확인

### 4.1 자동 연동 테스트
1. 체험단 신청 폼에서 테스트 지원
2. 구글 시트에 자동으로 데이터가 추가되는지 확인
3. 인스타그램 정보와 멤버십 정보도 함께 업데이트되는지 확인

### 4.2 수동 동기화 (필요시)
```bash
# API 호출로 전체 데이터 동기화
curl http://localhost:8000/api/admin/sync-google-sheet
```

## 📊 구글 시트 컬럼 구성

| 컬럼 | 설명 | 예시 |
|------|------|------|
| A: 지원일시 | 지원서 제출 시간 | 2025-01-18 18:30:25 |
| B: 이름 | 지원자 이름 | 김철수 |
| C: 전화번호 | 연락처 | 010-1234-5678 |
| D: 인스타그램 URL | 인스타그램 계정 | https://instagram.com/user |
| E: 주소 | 배송 주소 | (12345) 서울시 강남구... |
| F: 개인정보동의 | 동의 여부 | 동의/미동의 |
| G: 팔로워수 | 인스타그램 팔로워 | 1,524 |
| H: 게시물수 | 인스타그램 게시물 | 89 |
| I: 인스타 사용자명 | 추출된 사용자명 | user_name |
| J: 계정타입 | 계정 유형 | personal/business |
| K: 회원여부 | 기존 회원 확인 | 회원/비회원 |
| L: 멤버십타입 | 회원 등급 | GOLD/SILVER/등 |
| M: 회원ID | 회원 식별자 | M123456 |
| N: 만료일 | 멤버십 만료일 | 2025-12-31 |
| O: 인스타데이터수집일 | 수집 완료 시간 | 2025-01-18 18:31:15 |
| P: 멤버십조회일 | 조회 완료 시간 | 2025-01-18 18:31:20 |

## 🛡️ 보안 주의사항

### ✅ DO (권장사항)
- 서비스 계정 JSON 파일을 안전한 곳에 보관
- 구글 시트 공유를 필요한 사람만으로 제한
- 정기적으로 액세스 로그 확인

### ❌ DON'T (주의사항)
- JSON 파일을 GitHub 등 공개 저장소에 업로드하지 말 것
- 서비스 계정 이메일을 공개적으로 노출하지 말 것
- 불필요한 권한 부여하지 말 것

## 🔧 문제 해결

### 인증 오류 시
```
⚠️ 구글 시트 인증 파일이 없습니다. 수동으로 설정해주세요.
```
→ `google_credentials.json` 파일이 프로젝트 루트에 있는지 확인

### 권한 오류 시
```
❌ 구글 시트 업데이트 실패: [403] The caller does not have permission
```
→ 서비스 계정에 구글 시트 편집 권한이 있는지 확인

### API 비활성화 오류 시
```
❌ 구글 시트 연동 실패: Google Sheets API has not been used
```
→ Google Cloud Console에서 Sheets API와 Drive API 활성화 확인

## 🎉 완료!

설정이 완료되면 체험단 지원자가 신청할 때마다:
1. **즉시**: 기본 정보가 구글 시트에 추가
2. **2-3초 후**: 인스타그램 데이터 수집 완료
3. **동시**: 멤버십 정보 조회 완료
4. **자동**: 구글 시트에 모든 정보 업데이트

이제 관리자는 구글 시트에서 실시간으로 지원자 현황을 확인할 수 있습니다! 📊✨ 